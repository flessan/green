<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bottle Deposit Tracker - Home</title>
    <link rel="stylesheet" href="/up/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="logo">
                <i class="fas fa-recycle"></i> Green Generation
            </div>
            <nav>
                <ul>
                    <li><a href="index.html" class="active">Beranda</a></li>
                    <li><a href="dashboard.html" id="nav-dashboard" class="hidden">Dashboard</a></li>
                    <li><a href="rewards.html" id="nav-rewards" class="hidden">Hadiah</a></li>
                    <li><a href="news.html">Berita</a></li>
                    <li><a href="donate.html">Donasi</a></li>
                </ul>
            </nav>
            <div class="user-menu" id="user-menu" class="hidden">
                <span id="user-name"></span>
                <button id="logout-btn">Keluar</button>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <h1>Program Deposit Botol Plastik</h1>
                <p>Kumpulkan botol plastik, dapatkan poin, dan tukarkan dengan hadiah menarik!</p>
                
                <div id="login-section">
                    <button id="google-login" class="btn btn-primary">
                        <i class="fab fa-google"></i> Masuk dengan Google
                    </button>
                </div>
                
                <div id="user-section" class="hidden">
                    <div class="user-stats">
                        <div class="stat">
                            <div class="stat-value" id="user-points">0</div>
                            <div class="stat-label">Poin</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="user-level">1</div>
                            <div class="stat-label">Level</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="user-bottles">0</div>
                            <div class="stat-label">Botol</div>
                        </div>
                    </div>
                    <a href="dashboard.html" class="btn btn-primary">Ke Dashboard</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features">
        <div class="container">
            <h2>Cara Kerja</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-recycle"></i>
                    </div>
                    <h3>Kumpulkan Botol</h3>
                    <p>Kumpulkan botol plastik bekas dan bawa ke titik pengumpulan terdekat</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <h3>Dapatkan Poin</h3>
                    <p>Setiap botol yang Anda kumpulkan akan dikonversi menjadi poin</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-gift"></i>
                    </div>
                    <h3>Tukar Hadiah</h3>
                    <p>Tukarkan poin Anda dengan berbagai hadiah menarik yang tersedia</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="stats">
        <div class="container">
            <h2>Dampak Lingkungan</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-bottles">0</div>
                    <div class="stat-label">Total Botol Dikumpulkan</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-users">0</div>
                    <div class="stat-label">Pengguna Aktif</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-rewards">0</div>
                    <div class="stat-label">Hadiah Ditukarkan</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2025 Green Generation. Dibuat untuk mendukung lingkungan yang lebih bersih.</p>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    
    <script src="script.js"></script>
    <script>
        // Initialize Firebase
        const firebaseConfig = {
    apiKey: "apiKey",
    authDomain: "gryzfa.firebaseapp.com",
    databaseURL: "https://gryzfa-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "gryzfa",
    storageBucket: "gryzfa.firebasestorage.app",
    messagingSenderId: "604521234243",
    appId: "1:604521234243:web:1953b1a2ec316aac9df9f6",
    measurementId: "G-Y7L0680N16"
  };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Check if user is logged in
        auth.onAuthStateChanged(user => {
            if (user) {
                // User is signed in
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('user-section').classList.remove('hidden');
                document.getElementById('user-menu').classList.remove('hidden');
                document.getElementById('nav-dashboard').classList.remove('hidden');
                document.getElementById('nav-rewards').classList.remove('hidden');
                
                document.getElementById('user-name').textContent = user.displayName;
                
                // Load user data
                loadUserData(user.uid);
                loadGlobalStats();
            } else {
                // User is signed out
                document.getElementById('login-section').classList.remove('hidden');
                document.getElementById('user-section').classList.add('hidden');
                document.getElementById('user-menu').classList.add('hidden');
                document.getElementById('nav-dashboard').classList.add('hidden');
                document.getElementById('nav-rewards').classList.add('hidden');
                
                loadGlobalStats();
            }
        });

        // Google login
        document.getElementById('google-login').addEventListener('click', () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then(result => {
                    // Save user to Firestore
                    const user = result.user;
                    db.collection('users').doc(user.uid).set({
                        name: user.displayName,
                        email: user.email,
                        points: 0,
                        level: 1,
                        bottles: 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    }, { merge: true });
                })
                .catch(error => {
                    console.error('Error during sign in:', error);
                    alert('Gagal masuk. Silakan coba lagi.');
                });
        });

        // Logout
        document.getElementById('logout-btn').addEventListener('click', () => {
            auth.signOut();
        });

        // Load user data
        function loadUserData(userId) {
            db.collection('users').doc(userId).get().then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    document.getElementById('user-points').textContent = userData.points;
                    document.getElementById('user-level').textContent = userData.level;
                    document.getElementById('user-bottles').textContent = userData.bottles;
                }
            });
        }

        // Load global statistics
        function loadGlobalStats() {
            // Total bottles
            db.collection('deposits').get().then(snapshot => {
                let totalBottles = 0;
                snapshot.forEach(doc => {
                    totalBottles += doc.data().count;
                });
                document.getElementById('total-bottles').textContent = totalBottles;
            });

            // Total users
            db.collection('users').get().then(snapshot => {
                document.getElementById('total-users').textContent = snapshot.size;
            });

            // Total rewards redeemed
            db.collection('redemptions').get().then(snapshot => {
                document.getElementById('total-rewards').textContent = snapshot.size;
            });
        }
    </script>
</body>
</html>
